

= CT
== Khái niệm

Chụp cắt lớp vi tính, còn gọi là chụp CT (Computerized Tomography), là kỹ thuật kết hợp máy tính và tia X để tạo ra hình ảnh các cơ quan, xương và các mô của cơ thể theo lát cắt ngang, cho phép phóng 1 chùm tia X liên tục qua cơ thể. Đây là một kỹ thuật không xâm lấn.

Hình ảnh thu được sẽ được máy tính xử lý, tái tạo để cho ra cấu trúc bên trong. Độ phân giải (hay độ sắc nét) hình ảnh tuỳ thuộc vào thế hệ máy chụp là 4, 16, hay 64 lát cắt. Nếu máy chụp có số lát cát càng cao thì hình ảnh càng rõ nét. Tuỳ theo độ cản tia X, các tổn thương ở những bộ phận bên trong cơ thể được diễn tả bằng cách tăng hoặc giảm độ đậm.

Trong quá trình chụp CT, người bệnh được chỉ định nằm trên một chiếc máy, khi ấy máy dò và ống tia X sẽ xoay xung quanh, mỗi vòng quay sẽ cho ra một hình ảnh lát mỏng của cơ thể. Sau đó, những hình ảnh này được gửi đến máy tính, nơi chúng được kết hợp để tạo ra hình ảnh các lát cắt hoặc mặt cắt ngang của cơ thể. Quá trình này không mất nhiều thời gian và cũng không gây đau đớn cho người bệnh.

// https://www.vinmec.com/vie/bai-viet/chup-ct-va-mri-khac-nhau-nao-vi
// https://tamanhhospital.vn/chup-ct/
// 

== Lịch sử

 #figure(
   image("/images/ct-evolution.png", width: 80%),
  caption: [
      Quá trình phát triển của máy chụp CT.
  ],
 )
 
Năm 1917, Định lý Radon ra đời, đóng vai trò quan trọng trong việc phát triển thuật toán tái tạo ảnh của chụp CT sau này.

Giai đoạn sơ khai (1971 - 1985):
- 1971: Hệ thống chụp CT đầu tiên được phát minh, tập trung vào quét não (*Head CT*).
- 1974: Công nghệ mở rộng ra để chụp toàn bộ cơ thể (*Body CT*), đánh dấu bước tiến quan trọng trong chẩn đoán y khoa.
- 1975: Sự ra đời của máy CT thế hệ thứ ba (*3rd Generation CT*), giúp tăng tốc độ chụp ảnh.

Giai đoạn cải tiến công nghệ (1987 - 2000):
- 1987: Phát triển công nghệ *Solid State Detectors* (Bộ dò trạng thái rắn), giúp tăng cường độ nhạy và cải thiện chất lượng hình ảnh.
- 1990: Ứng dụng công nghệ *Slip Ring*, giúp chụp xoắn ốc (Helical CT), mở đường cho chụp ảnh 3D tốc độ cao.
- 1993: Công nghệ CT có khả năng chụp 4 hoặc 8 lát cắt (4/8-Slice CT), tăng đáng kể độ chi tiết của hình ảnh.
- 1995: Tốc độ quét giảm xuống còn 1.0 giây/lần chụp.

Giai đoạn phát triển mạnh mẽ (2000 - 2010):
- 2000: Cải tiến tốc độ quét còn 0.8 giây/lần, đồng thời áp dụng phương pháp giảm liều phóng xạ *AEC Dose Reduction*.
- 2002: Ra mắt CT 16 lát cắt (*16-Slice CT*), cải thiện đáng kể khả năng phân giải không gian.
- 2005: Tiếp tục giảm tốc độ quét xuống còn 0.5 giây/lần, giúp chụp nhanh hơn.
- 2007: CT 32/64 lát cắt (*32/64-Slice CT*) xuất hiện, hỗ trợ chẩn đoán chi tiết hơn, đặc biệt là trong tim mạch.
- 2008: Phát triển công nghệ *Spectral Imaging* và *ASiR* (Adaptive Statistical Iterative Reconstruction), giúp giảm nhiễu ảnh và tối ưu hóa chất lượng hình ảnh.

Giai đoạn hiện đại:
- 2010: Công nghệ CT có độ phân giải cao (Hi-Res CT), cung cấp hình ảnh sắc nét hơn.
- 2011: Giới thiệu *Veo Iterative Reconstruction*, một thuật toán tái tạo ảnh tiên tiến giúp giảm liều phóng xạ nhưng vẫn giữ được chất lượng hình ảnh cao.
- 2012: Xuất hiện công nghệ *Motion Correction*, giúp cải thiện hình ảnh của các bộ phận di chuyển như tim và phổi.

= MRI

== Khái niệm

Chụp cộng hưởng từ hay còn gọi là chụp MRI (Magnetic Resonance Imaging) là phương pháp sử dụng từ trường mạnh, sóng vô tuyến và máy tính để phác hoạ hình ảnh chi tiết bên trong cơ thể con người. Đây là một kỹ thuật không xâm lấn.  
Không giống như chụp X-quang và chụp cắt lớp vi tính (CT), MRI không sử dụng bức xạ ion hóa gây hại của tia X.

Máy MRI hoạt động bằng cách tạo ra một từ trường mạnh bên trong cơ thể. Một máy tính lấy các tín hiệu từ MRI để tạo ra hàng loạt ảnh, mỗi bức ảnh cho thấy một phần mỏng của cơ thể.

== Nguyên tắc 

- Một từ trường mạnh được tạo ra bởi máy MRI, làm cho các hạt nhân hydrogen trong cơ thể bệnh nhân (các proton) thẳng hàng theo hướng của từ trường.
- Các hạt nhân hydrogen bắt đầu quay quanh hướng từ trường chính với một tần số gọi là tần số Larmor, liên quan đến cường độ từ trường và đặc tính của hạt nhân.
- Máy MRI phát một xung radio tại tần số Larmor, làm các hạt nhân hydrogen bị kích thích và lệch khỏi hướng ban đầu của từ trường.
- Khi xung radio ngừng, các hạt nhân hydrogen trở về trạng thái ban đầu. Trong quá trình này, chúng phát ra tín hiệu mà máy MRI thu thập.
- Các tín hiệu thu thập được từ cơ thể bệnh nhân được máy tính xử lý để tạo ra hình ảnh 2D hoặc 3D của các mô mềm.

== Các chế độ hình ảnh
1. T1-Weighted (T1W) Imaging
Đặc điểm:

- Chụp với thời gian lặp ngắn (TR) và thời gian vang ngắn (TE).

- Rất nhạy với mỡ.

Nhìn chung:

- Dịch não tủy (CSF): Rất đen.

- Mỡ: Trắng.

- Chất xám: Xám đậm.

- Chất trắng: Xám sáng.

- Ứng dụng: Tốt để quan sát các cấu trúc giải phẫu.

2. T2-Weighted (T2W) Imaging
Đặc điểm:

- Chụp với thời gian lặp dài (TR) và thời gian vang dài (TE).

- Rất nhạy với dịch não tủy (CSF).

Nhìn chung:

- CSF: Rất trắng.

- Mỡ: Xám.

- Chất xám: Xám sáng.

- Chất trắng: Xám đậm.

- Ứng dụng: Phát hiện tổn thương, phù nề, hoặc các vấn đề liên quan đến nước.

3. Các chế độ nâng cao khác
- FLAIR (Fluid-Attenuated Inversion Recovery): Loại bỏ tín hiệu từ CSF, giúp làm nổi bật các tổn thương.

- DWI (Diffusion-Weighted Imaging): Tập trung vào sự khuếch tán của nước, hữu ích trong chẩn đoán đột quỵ.

- DTI (Diffusion Tensor Imaging): Phân tích các đường dẫn của chất trắng, thường dùng trong nghiên cứu thần kinh.

= Định lý Phép chiếu Lát cắt (Projection Slice Theorem)

Đây là một định lý quan trọng trong Xử lý ảnh y khoa và Tomography.

Cho $f(x, y)$ là ảnh 2 chiều.

Ta định nghĩa phép biến đổi Fourier 2 chiều của nó:

$
  F(u, v) = integral_(-infinity)^(infinity) integral_(-infinity)^(infinity) f(x, y) e^(-j 2 pi (u x + v y) ) dif x dif y
$

Giả sử ta lấy một phép chiếu theo hướng $theta$, tức là tích luỹ cường độ theo trục vuông góc với hướng đó:

$
  P_theta (r) = integral_(-infinity)^(infinity) f (r cos theta - s sin theta, r sin theta + s cos theta ) dif s
$

Đây là phép chiếu Radon, cho ta một ảnh 1D (1 chiều) biểu diễn cách ảnh gốc lan truyền theo hướng $theta$.

Định lý Phép chiếu Lát cắt khẳng định rằng biến đổi Fourier 1 chiều của phép chiếu $ P_theta (r) $ chính là một lắt cắt của biến đổi Fourier 2 chiều $F (u, v)$ dọc theo đường thẳng có góc $theta$ trong miền tần số:

$
  P_theta (k) = F (k cos theta, k sin theta)
$

= Kiến trúc chương trình Slicer 
1. Lõi ứng dụng Slicer (Slicer Application Core):

Đây là phần trung tâm của ứng dụng, nơi quản lý hoạt động chính của hệ thống.

2. Cảnh MRML (MRML Scene):

Cảnh này tương tác trực tiếp với các mô-đun (Modules) khác nhau.

Là nơi chứa và tổ chức tất cả các nút (Nodes), cũng như quản lý dữ liệu và mối quan hệ giữa chúng.

3. Các Mô-đun (Modules):

Bao gồm nhiều mô-đun như Module A, Module B, ... Module N.

Các mô-đun này thực hiện các chức năng chuyên biệt, ví dụ: phân đoạn, đăng ký hình ảnh hoặc phân tích.

Chúng tương tác với Cảnh MRML để đọc và ghi dữ liệu.

Một kiểu mô-đun là C++ loadable:
- Được viết bằng C++
- Có thể truy cập đầy đủ API Slicer
- Hữu ích trong thực thi các thành phần/cơ sở hạ tầng ứng dụng phức tạp, hiệu suất quan trọng
4. Tiện ích mở rộng (Extensions):

Bao gồm các mô-đun mở rộng như Module X, Module Y, ... Module Z.

Các tiện ích này mở rộng thêm chức năng của chương trình, phù hợp với các nhu cầu cụ thể.

5. Thư viện tích hợp (Libraries):

Chương trình sử dụng các thư viện như Qt, VTK, ITK, CTK, Python, numpy, v.v., để xử lý giao diện, hiển thị hình ảnh, tính toán, và nhiều chức năng khác.

= Mô hình dữ liệu Slicer
Slicer sử dụng MRML để quản lý và tổ chức dữ liệu y tế bằng API được cung cấp bởi thư viện. Mỗi kiểu dữ liệu được đại diện bởi một nút (node) MMRL đặc biệt.\
\
Mô hình dữ liệu Slicer MRML được triển khai độc lập với các thành phần trực quan hóa và thuật toán của hệ thống.
Các thành phần Slicer khác (Logic và GUI) quan sát các thay đổi trong cảnh MRML và các nút riêng lẻ và xử lý các sự kiện MRML thay đổi.

1. MRML Scene
MRML Scene quản lý các nút MRML: thêm, xóa, tìm, tìm theo loại, v.v.
MRML Scene cung cấp tính bền bỉ của các nút MRML (đọc/ghi vào/từ tệp XML).\
MRML Scene cung cấp cơ chế Hoàn tác/Làm lại để khôi phục trạng thái trước đó của cảnh và các nút riêng lẻ.

2. Các nút MMRL
Vai trò của nút MRML\
- Lưu trữ dữ liệu: Mỗi nút đại diện cho một loại dữ liệu cụ thể trong 3D Slicer, chẳng hạn như hình ảnh (volumes), mô hình (models), phân đoạn (segmentations), hoặc điểm chú thích (fiducials).

- Chuyển đổi dữ liệu sang dạng XML: Nút MRML hỗ trợ việc tuần tự hóa (serialization) dữ liệu để lưu trữ vào tệp XML. Điều này giúp dữ liệu có thể được xuất và nhập một cách dễ dàng.

- Không tích hợp hiển thị hoặc xử lý: Nút MRML không chứa các phương pháp hiển thị hay xử lý dữ liệu; các chức năng này được xử lý bởi các lớp khác như Display Node hoặc Logic Layer.

- Các loại nút MRML cơ bản
    - Data Node (Nút dữ liệu): Chứa nội dung dữ liệu chính, chẳng hạn như hình ảnh, mô hình hoặc kết quả phân đoạn.
    - Display Node (Nút hiển thị): Xác định các tùy chọn hiển thị cho nội dung của nút dữ liệu; cho phép sử dụng nhiều nút hiển thị cho cùng một nút dữ liệu, giúp hiển thị dưới nhiều hình thức khác nhau.
    - Storage Node (Nút lưu trữ): Xác định định dạng tệp và tên tệp được sử dụng để lưu trữ dữ liệu của nút. Đảm bảo tính bền vững cho dữ liệu.
Các nút MRML được tổ chức thành các phân cấp lớp C++, tất cả đều bắt nguồn từ lớp vtkMRMLNode.

Tất cả các nút MRML phải triển khai một số API chuẩn nhất định: ReadAttributes, WriteAttributes, Copy, v.v.

#show link: underline
Sau đây là một tập hợp các nút MRLN cốt lõi lưu trữ trạng thái của các mô-đun cốt lõi: #link("https://www.slicer.org/wiki/Slicer3:Data_Model#:~:text=vtkMRMLCameraNode,vtkMRMLVolumeArchetypeStorageNode")[Danh sách các nút]

Các mô-đun giao tiếp thông qua đọc/viết lên các nút mà không cần phải nhận biết nhau.

3. Tham chiếu

Một số nút MRML có tham chiếu đến các nút khác.
Nút có thể chuyển đổi có tham chiếu đến một nút chuyển đổi. Nút chuyển đổi có tham chiếu đến nút chuyển đổi cha của nó.
Tham chiếu được lưu trữ theo ID nút.

Sử dụng vtkSetReferenceStringMacro để đặt ID tham chiếu (nó đăng ký tham chiếu với cảnh).

Các phương thức truy cập sẽ kiểm tra xem nút được tham chiếu có vẫn nằm trong cảnh MRML bằng ID của nó hay không.

= Chẩn đoán hỗ trợ bởi máy tính

Chẩn đoán hỗ trợ bởi máy tính (Computer Aided Diagnosis - CAD) là một lĩnh vực kết hợp giữa công nghệ thông tin và y học, nhằm cải thiện độ chính xác và hiệu quả trong việc chẩn đoán bệnh. Hệ thống CAD sử dụng các thuật toán xử lý và phân tích hình ảnh để hỗ trợ các bác sĩ trong việc đưa ra quyết định.

== Quy trình hoạt động của CAD
- Thu thập dữ liệu: Dữ liệu thường là hình ảnh y khoa (như X-quang, CT, MRI) được thu thập từ bệnh nhân.

- Tiền xử lý: Hình ảnh được xử lý để loại bỏ nhiễu và tăng độ rõ nét, giúp cải thiện chất lượng phân tích.

- Phân đoạn: Hệ thống CAD sử dụng thuật toán để phân chia hình ảnh thành các vùng cụ thể, như vùng tổn thương hoặc vùng không liên quan.
- Phát hiện và phân loại: Thuật toán nhận diện các bất thường trong hình ảnh (như khối u hoặc tổn thương) và phân loại chúng theo mức độ nguy cơ hoặc loại bệnh.
- Đánh giá: CAD cung cấp một bản phân tích chi tiết để hỗ trợ bác sĩ trong việc đánh giá tình trạng bệnh và quyết định điều trị.

== Vai trò của CAD trong y học
- Ý kiến thứ hai (Second opinion): CAD không thay thế bác sĩ, nhưng đóng vai trò như một ý kiến hỗ trợ, giúp giảm nguy cơ chẩn đoán sai.

- Tăng độ chính xác: CAD có thể phát hiện các dấu hiệu sớm của bệnh mà đôi khi mắt người không nhận ra.

- Tiết kiệm thời gian: Hệ thống tự động phân tích hàng loạt hình ảnh, giảm thời gian cần thiết cho bác sĩ.

== Một số trở ngại của CAD:
1. Sự đa dạng (Diversities)
CAD phải xử lý nhiều yếu tố đa dạng, bao gồm:

- Cơ quan/tổ chức mục tiêu: Các cơ quan hoặc mô cần phân tích rất khác nhau, từ tim, phổi đến não.

- Loại bệnh được chẩn đoán: Sự phức tạp trong nhiều loại bệnh khác nhau có thể yêu cầu các cách tiếp cận riêng biệt.

- Đặc điểm bệnh nhân: Tuổi, giới tính, chủng tộc, lịch sử y tế đều có thể ảnh hưởng đến kết quả chẩn đoán.

2. Thống kê trong tập dữ liệu (Statistics in Dataset)
- Số lượng bệnh nhân ít đối với bệnh nghiêm trọng: Những bệnh lý nghiêm trọng thường có số lượng bệnh nhân ít, làm hạn chế dữ liệu để huấn luyện mô hình.
- Bệnh phức tạp: Các căn bệnh khó chẩn đoán thường là mục tiêu của CAD, đòi hỏi sự hỗ trợ cao hơn từ hệ thống.

3. Tiền xử lý (Preprocessing)
- CAD cần thực hiện các bước như phân đoạn (segmentation) và đăng ký hình ảnh (registration), nhưng:

  - Đây là những bước quan trọng nhưng khó tự động hóa hoàn toàn.

  - Nhiều nhà nghiên cứu (bao gồm các chuyên gia công nghệ thông tin) có thể né tránh làm việc với giai đoạn này.

  - Dữ liệu tái tạo (rebuild datasets) thường chỉ có sẵn cho các bệnh phổ biến, gây khó khăn cho các bệnh hiếm.

== Các thách thức cho CAD

1. Thu thập dữ liệu và đánh giá chất lượng (Data Collection and Quality Assessment):

- Dữ liệu y tế cần được chuẩn hóa và đảm bảo chất lượng cao để các hệ thống CAD hoạt động chính xác.
- Việc quản lý dữ liệu từ nhiều nguồn khác nhau là một khó khăn lớn.

2. Phát triển các thuật toán phân đoạn tiên tiến (Advanced Segmentation Approaches):
Phân đoạn hình ảnh là bước quan trọng trong CAD nhưng thường đòi hỏi các thuật toán mạnh mẽ hơn để xử lý các cấu trúc phức tạp.

3. Trích xuất và chọn lọc đặc điểm (Advanced Feature Extraction / Selection):

- Việc lựa chọn đặc điểm ảnh hưởng trực tiếp đến khả năng phân loại và dự đoán của CAD.

4. Phân loại và khai thác dữ liệu (Classification and Data Mining):

- Thuật toán phân loại cần được cải thiện để tăng độ chính xác trong việc nhận diện bệnh lý.

5. Xử lý dữ liệu lớn (Big Data):

- CAD sẽ cần tích hợp các công nghệ xử lý dữ liệu lớn để phân tích hiệu quả và nhanh chóng hàng triệu trường hợp bệnh nhân.

6. Ứng dụng trong thực tiễn lâm sàng (Clinical Practice Adaptation):

- Một trong những thách thức lớn nhất là làm cho CAD phù hợp và dễ sử dụng đối với các chuyên gia y tế trong môi trường thực tế.

7. Đánh giá hiệu suất tiêu chuẩn hóa (Standardized Performance Assessment):

- Hiện chưa có tiêu chuẩn cụ thể để đánh giá hiệu suất của các hệ thống CAD. Điều này cần được phát triển để đảm bảo tính minh bạch và độ tin cậy.

== Quá trình bùng nổ AI và tác động đến CAD

1. Kỷ nguyên đầu tiên của AI (1960):

- AI thời kỳ này dựa trên phương pháp "Suy luận bằng tìm kiếm" (Inference by search).
- Nghiên cứu CAD tự động chẩn đoán bắt đầu xuất hiện, đánh dấu bước khởi đầu cho công nghệ xử lý hình ảnh y tế.

2. Kỷ nguyên thứ hai của AI (1980):

- AI tập trung vào "Suy luận bằng kiến thức" (Inference by knowledge).

- Đây là thời điểm nghiên cứu CAD tại Đại học Chicago được khởi động, mở đường cho các ứng dụng CAD thực tế hơn trong y tế.

3. Kỷ nguyên thứ ba của AI (2010 và sau đó):

- Sự phát triển mạnh mẽ của "Suy luận thông qua học tập" (Reasoning by learning), với AI chuyển sang sử dụng học sâu (Deep Learning).

- CAD đã chuyển mình thành AI-CAD, tích hợp các thuật toán học sâu để cải thiện khả năng nhận diện và phân tích hình ảnh y tế.

Tương lai hứa hẹn của CAD trong thời bùng nổ AI
- Hiệu suất vượt trội:

AI giúp CAD đạt hiệu suất cao hơn 10 triệu lần so với thời kỳ đầu, nhờ sự cải tiến về khả năng tính toán của máy tính.

- Cá nhân hóa chẩn đoán:

AI cho phép phân tích dữ liệu đa chiều, từ hình ảnh y tế đến hồ sơ bệnh lý và dữ liệu di truyền, tạo ra các giải pháp chẩn đoán chính xác và phù hợp với từng bệnh nhân.

- Tự động hóa toàn diện:
Với AI, CAD có thể tự động hóa hầu hết quy trình chẩn đoán, giảm áp lực cho các chuyên gia y tế.
